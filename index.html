<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bridge — Handoff Hub</title>
<meta name="description" content="Bridge is the handoff hub from Garlic/School/Earth to Harbor and then to Dagny. When checks are green, cross." />
<style>
  :root{
    --bg:#0b0c11; --ink:#eaf0ff; --muted:#a9b0d5; --line:#2a2f4a; --good:#73e3c5; --warn:#ffd089;
    --accent:#79e0c8; --accent2:#d08bff; --shadow:0 10px 30px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    background: radial-gradient(1200px 800px at 70% 20%, #13162a 0%, #0b0c11 60%, #08090e 100%);
    font: 500 16px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  }
  .wrap{max-width:980px; margin:0 auto; padding:22px; display:grid; gap:14px}
  .title{font-weight:800; font-size:24px; letter-spacing:.25px; text-align:center}
  .sub{color:var(--muted); text-align:center; font-size:14px}

  .card{
    background:linear-gradient(180deg, rgba(18,22,40,.92), rgba(14,17,32,.92));
    border:1px solid rgba(120,130,170,.22);
    border-radius:16px; padding:16px; box-shadow:var(--shadow);
  }
  h2{margin:0 0 8px 0; font-size:18px; letter-spacing:.2px}
  .grid{display:grid; gap:12px}
  @media(min-width:860px){ .grid{grid-template-columns:1fr 1fr} }

  /* path steps */
  .path{ display:grid; grid-template-columns: repeat(4,1fr); gap:8px; margin-top:6px }
  .step{
    border:1px solid rgba(120,130,170,.28); border-radius:12px; padding:10px; text-align:center; font-size:13px; color:#dfe3ff;
    background:rgba(255,255,255,.03);
  }
  .ok{ border-color:rgba(121,224,200,.7); background:rgba(121,224,200,.1) }
  .note{ color:#cfd4ff; font-size:13px; text-align:center; margin-top:6px }
  .kbd{font:600 11px ui-monospace, SFMono-Regular, Menlo, monospace; padding:2px 6px; border:1px solid rgba(200,210,255,.2); border-radius:6px; background:#0f1221; color:#dde3ff}

  /* harbor status strip */
  .harbor{
    border:1px solid rgba(120,130,170,.28); border-left:4px solid var(--accent);
    background:linear-gradient(180deg, rgba(121,224,200,.12), rgba(121,224,200,.06));
    border-radius:12px; padding:12px; display:flex; align-items:center; gap:12px; flex-wrap:wrap;
  }
  .flag{
    font:700 11px ui-monospace, SFMono-Regular, Menlo, monospace; padding:3px 8px; border-radius:999px; border:1px solid rgba(120,130,170,.35); color:#d6dcff
  }
  .flag.on{ border-color:rgba(121,224,200,.8); color:#eafff8 }
  .flag.off{ border-color:rgba(255,208,137,.8); color:#fff3dc }
  .hand{
    margin-left:auto; font:700 11px ui-monospace, SFMono-Regular, Menlo, monospace; color:#dff9f3;
  }

  /* routes */
  .routes{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:10px; margin-top:8px }
  .btn{
    display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; text-decoration:none;
    border:1px solid rgba(120,130,170,.35); color:#eaf0ff; font-weight:700; letter-spacing:.2px; background:rgba(255,255,255,.03);
    transition:transform .12s ease, border-color .12s ease, background .12s ease;
  }
  .btn:hover{ transform:translateY(-1px)}
  .primary{ border-color:rgba(121,224,200,.7); background:rgba(121,224,200,.12) }
  .dim{ opacity:.6 }

  .center{ text-align:center }
</style>
</head>
<body>
  <main class="wrap">
    <header>
      <div class="title">Bridge</div>
      <div class="sub">Handoff hub. When the checks are green, cross to the right place.</div>
    </header>

    <section class="grid">
      <!-- Garlic → School → Earth → Dagny (legacy pathway visibility) -->
      <section class="card">
        <h2>Pathway Status (Garlic → School → Earth → Dagny)</h2>
        <div class="path" id="path">
          <div class="step" id="s-garlic">Garlic</div>
          <div class="step" id="s-school">School</div>
          <div class="step" id="s-earth">Earth</div>
          <div class="step" id="s-dagny">Dagny</div>
        </div>
        <div class="note" id="note">Awaiting confirmation from Garlic index…</div>
      </section>

      <!-- Harbor block -->
      <section class="card">
        <h2>Harbor Clearance (Sanela)</h2>
        <div class="harbor" id="harbor-strip">
          <span id="f-credit"  class="flag off">credit</span>
          <span id="f-consent" class="flag off">consent</span>
          <span id="f-resource" class="flag off">resource</span>
          <span id="f-all" class="flag">—</span>
          <span class="hand" id="handshake">handshake: <span id="handshake-time">—</span></span>
        </div>
        <div class="routes" style="margin-top:10px">
          <a class="btn primary dim" id="to-dagny" href="https://dagny.plnt.earth" rel="noopener">Proceed to Dagny</a>
          <a class="btn" href="https://harbor.plnt.earth" rel="noopener">Open Harbor</a>
          <a class="btn" href="https://earth.plnt.earth" rel="noopener">Return to Earth</a>
        </div>
      </section>
    </section>

    <!-- Routes directory -->
    <section class="card">
      <h2>Routes</h2>
      <div class="routes">
        <a class="btn" href="https://garlic.plnt.earth" rel="noopener">Garlic</a>
        <a class="btn" href="https://school.plnt.earth" rel="noopener">School</a>
        <a class="btn" href="https://earth.plnt.earth" rel="noopener">Earth</a>
        <a class="btn" href="https://harbor.plnt.earth" rel="noopener">Harbor</a>
        <a class="btn" href="https://dagny.plnt.earth" id="dir-dagny" rel="noopener">Dagny</a>
        <a class="btn" href="https://mirrorhoney.plnt.earth" rel="noopener">MirrorHoney</a>
        <a class="btn" href="https://honey.plnt.earth" rel="noopener">Honey</a>
        <a class="btn" href="https://froot.plnt.earth" rel="noopener">Froot</a>
        <a class="btn" href="https://motion.plnt.earth" rel="noopener">Motion</a>
        <a class="btn" href="https://time.plnt.earth" rel="noopener">Time</a>
        <a class="btn" href="https://wonder.plnt.earth" rel="noopener">Wonder</a>
        <a class="btn" href="https://clarity.plnt.earth" rel="noopener">Clarity</a>
        <a class="btn" href="https://alter.fire.plnt.earth" rel="noopener">Alter.Fire</a>
      </div>
      <p class="note">Bridge reflects local state saved on this device from Garlic and Harbor.</p>
    </section>

    <footer class="note center"><span class="kbd">&lt;!-- all from garlic --&gt;</span> · Harbor green = motion permitted</footer>
  </main>

<script>
  (function(){
    // ---------- Garlic path state (legacy four checks) ----------
    var keys = ["garlic","school","earth","dagny"];
    var ok = false;
    try{
      var saved = JSON.parse(localStorage.getItem('illumina.afg.v1')||'{}');
      ok = keys.every(function(k){ return !!saved[k]; });
      keys.forEach(function(k){
        var el = document.getElementById('s-'+k);
        if(el && saved[k]) el.classList.add('ok');
      });
      document.getElementById('note').textContent = ok ? 'All green (Garlic path).' : 'Waiting for all four checks from Garlic index.';
    }catch(e){
      document.getElementById('note').textContent = 'No local state found. Visit Garlic index first.';
    }

    // ---------- Harbor state (credit/consent/resource + handshake) ----------
    function truthy(v){
      if(v==null) return false;
      var s = String(v).toLowerCase().trim();
      return !(s===""||s==="0"||s==="false"||s==="null"||s==="undefined");
    }
    function flag(id, on){
      var el = document.getElementById(id);
      if(!el) return;
      el.classList.remove('on','off');
      el.classList.add(on ? 'on':'off');
    }

    var credit   = truthy(localStorage.getItem('harbor.credit'));
    var consent  = truthy(localStorage.getItem('harbor.consent'));
    var resource = truthy(localStorage.getItem('harbor.resource'));
    var all = credit && consent && resource;

    flag('f-credit', credit);
    flag('f-consent', consent);
    flag('f-resource', resource);

    var fAll = document.getElementById('f-all');
    fAll.textContent = all ? 'all green' : '—';
    fAll.classList.add(all ? 'on' : 'off');

    var human = localStorage.getItem('harbor.lastClearedHuman') || '';
    if(!human){
      var iso = localStorage.getItem('harbor.lastCleared');
      try{ if(iso){ human = new Date(iso).toLocaleString(); } }catch(e){}
    }
    var hs = document.getElementById('handshake');
    var hst = document.getElementById('handshake-time');
    if(all){
      hst.textContent = human || 'now';
    }else{
      hs.style.opacity = .7;
      hst.textContent = '—';
    }

    // Gate Dagny links based on Harbor
    var toDagny = document.getElementById('to-dagny');
    var dirDagny = document.getElementById('dir-dagny');
    if(all){
      toDagny.classList.remove('dim');
      toDagny.setAttribute('aria-disabled','false');
      dirDagny.classList.remove('dim');
    }else{
      toDagny.classList.add('dim');
      toDagny.setAttribute('aria-disabled','true');
      toDagny.addEventListener('click', function(e){ e.preventDefault(); }, {once:true});
      dirDagny.classList.add('dim');
    }
  })();
</script>
</body>
</html>
